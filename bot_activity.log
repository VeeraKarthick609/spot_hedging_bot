2025-07-07 21:25:43,361 - __main__ - INFO - Starting bot...
2025-07-07 21:25:43,788 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:25:43,788 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:25:43,788 - __main__ - INFO - Bot is polling for updates...
2025-07-07 21:25:44,634 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 21:25:44,634 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 21:25:44,635 - telegram.ext.Application - INFO - Application started
2025-07-07 21:25:53,792 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:56:53 UTC)" (scheduled at 2025-07-07 15:55:53.784835+00:00)
2025-07-07 21:25:53,793 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:56:53 UTC)" executed successfully
2025-07-07 21:26:33,706 - services.data_fetcher - INFO - Fetched 737 option instruments for BTC.
2025-07-07 21:26:33,707 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py", line 1195, in process_update
    await coroutine
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_conversationhandler.py", line 850, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_basehandler.py", line 153, in handle_update
    return await self.callback(update, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\bot\handlers.py", line 158, in select_strategy
    date_obj = datetime.strptime(expiry, '%d%b%y')
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Karthick\AppData\Local\Programs\Python\Python311\Lib\_strptime.py", line 567, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Karthick\AppData\Local\Programs\Python\Python311\Lib\_strptime.py", line 349, in _strptime
    raise ValueError("time data %r does not match format %r" %
ValueError: time data '250708' does not match format '%d%b%y'
2025-07-07 21:26:53,800 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:57:53 UTC)" (scheduled at 2025-07-07 15:56:53.784835+00:00)
2025-07-07 21:26:53,801 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:26:55,824 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108294.40, Threshold: $500.00
2025-07-07 21:26:55,824 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 21:26:56,080 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 21:26:56,185 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 21:26:56,200 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:26:56,201 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,294.40, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:26:57,008 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:57:53 UTC)" executed successfully
2025-07-07 21:27:53,790 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:58:53 UTC)" (scheduled at 2025-07-07 15:57:53.784835+00:00)
2025-07-07 21:27:53,791 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:27:54,298 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108307.20, Threshold: $500.00
2025-07-07 21:27:54,298 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:27:54,298 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,307.20, beta=0.9985, required_hedge_contracts=-0.9991
2025-07-07 21:27:55,026 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:58:53 UTC)" executed successfully
2025-07-07 21:28:53,796 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:59:53 UTC)" (scheduled at 2025-07-07 15:58:53.784835+00:00)
2025-07-07 21:28:53,797 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:28:55,088 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108307.00, Threshold: $500.00
2025-07-07 21:28:55,088 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:28:55,088 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,307.00, beta=0.9985, required_hedge_contracts=-0.9991
2025-07-07 21:28:55,825 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 15:59:53 UTC)" executed successfully
2025-07-07 21:29:53,803 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:00:53 UTC)" (scheduled at 2025-07-07 15:59:53.784835+00:00)
2025-07-07 21:29:53,803 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:29:54,401 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108299.50, Threshold: $500.00
2025-07-07 21:29:54,402 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:29:54,402 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,299.50, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:29:55,133 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:00:53 UTC)" executed successfully
2025-07-07 21:30:53,793 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:01:53 UTC)" (scheduled at 2025-07-07 16:00:53.784835+00:00)
2025-07-07 21:30:53,793 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:01:53 UTC)" executed successfully
2025-07-07 21:31:53,794 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:02:53 UTC)" (scheduled at 2025-07-07 16:01:53.784835+00:00)
2025-07-07 21:31:53,794 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:02:53 UTC)" executed successfully
2025-07-07 21:32:53,785 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:03:53 UTC)" (scheduled at 2025-07-07 16:02:53.784835+00:00)
2025-07-07 21:32:53,786 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:03:53 UTC)" executed successfully
2025-07-07 21:33:43,682 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 21:33:43,683 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 21:33:43,683 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 21:33:43,684 - __main__ - INFO - Bot is shutting down...
2025-07-07 21:33:44,049 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:33:44,050 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:33:44,050 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020B34A949D0>
2025-07-07 21:33:44,051 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020B3696E810>
2025-07-07 21:33:49,294 - __main__ - INFO - Starting bot...
2025-07-07 21:33:49,730 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:33:49,730 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:33:49,731 - __main__ - INFO - Bot is polling for updates...
2025-07-07 21:33:50,448 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 21:33:50,448 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 21:33:50,449 - telegram.ext.Application - INFO - Application started
2025-07-07 21:33:59,730 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:04:59 UTC)" (scheduled at 2025-07-07 16:03:59.729521+00:00)
2025-07-07 21:33:59,731 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:04:59 UTC)" executed successfully
2025-07-07 21:34:26,635 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:34:34,890 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:34:38,176 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py", line 1195, in process_update
    await coroutine
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_conversationhandler.py", line 850, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_basehandler.py", line 153, in handle_update
    return await self.callback(update, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\bot\handlers.py", line 217, in select_strike
    asset = user_positions[query.effective_chat.id]['asset']
                           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'CallbackQuery' object has no attribute 'effective_chat'
2025-07-07 21:34:59,734 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:05:59 UTC)" (scheduled at 2025-07-07 16:04:59.729521+00:00)
2025-07-07 21:34:59,735 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:35:00,348 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108324.00, Threshold: $500.00
2025-07-07 21:35:00,349 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 21:35:00,607 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 21:35:00,677 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 21:35:00,681 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:35:00,681 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,324.00, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:35:01,577 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:05:59 UTC)" executed successfully
2025-07-07 21:35:36,559 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 21:35:36,560 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 21:35:36,560 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 21:35:36,561 - __main__ - INFO - Bot is shutting down...
2025-07-07 21:35:36,831 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:35:36,832 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:35:36,832 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000258FFBF1690>
2025-07-07 21:35:36,833 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025893369150>
2025-07-07 21:35:43,796 - __main__ - INFO - Starting bot...
2025-07-07 21:35:44,228 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:35:44,229 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:35:44,229 - __main__ - INFO - Bot is polling for updates...
2025-07-07 21:35:44,974 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 21:35:44,975 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 21:35:44,975 - telegram.ext.Application - INFO - Application started
2025-07-07 21:35:54,241 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:06:54 UTC)" (scheduled at 2025-07-07 16:05:54.228844+00:00)
2025-07-07 21:35:54,241 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:06:54 UTC)" executed successfully
2025-07-07 21:36:19,617 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:36:26,585 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:36:29,913 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py", line 1195, in process_update
    await coroutine
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_conversationhandler.py", line 850, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_basehandler.py", line 153, in handle_update
    return await self.callback(update, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\bot\handlers.py", line 217, in select_strike
    asset = user_positions[query.message.id]['asset']
            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 60
2025-07-07 21:36:45,058 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 21:36:45,059 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 21:36:45,059 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 21:36:45,060 - __main__ - INFO - Bot is shutting down...
2025-07-07 21:36:45,500 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:36:45,500 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:36:45,500 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017DE5260810>
2025-07-07 21:36:45,501 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017DE51FD6A0>, 37719.203)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017DE4D484D0>
2025-07-07 21:36:45,501 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017DE3A5F590>
2025-07-07 21:36:45,502 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000017DE714C7C0>, 37726.359)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000017DE7113850>
2025-07-07 21:37:05,453 - __main__ - INFO - Starting bot...
2025-07-07 21:37:05,878 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:37:05,879 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:37:05,879 - __main__ - INFO - Bot is polling for updates...
2025-07-07 21:37:06,710 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 21:37:06,710 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 21:37:06,710 - telegram.ext.Application - INFO - Application started
2025-07-07 21:37:15,887 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:08:15 UTC)" (scheduled at 2025-07-07 16:07:15.877938+00:00)
2025-07-07 21:37:15,888 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:08:15 UTC)" executed successfully
2025-07-07 21:38:05,599 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:38:11,253 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:38:14,737 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py", line 1195, in process_update
    await coroutine
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_conversationhandler.py", line 850, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_basehandler.py", line 153, in handle_update
    return await self.callback(update, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\bot\handlers.py", line 217, in select_strike
    asset = user_positions[query.message.id]['asset']
            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 67
2025-07-07 21:38:15,885 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:09:15 UTC)" (scheduled at 2025-07-07 16:08:15.877938+00:00)
2025-07-07 21:38:15,885 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:38:16,220 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108296.60, Threshold: $500.00
2025-07-07 21:38:16,221 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 21:38:16,459 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 21:38:16,554 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 21:38:16,558 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:38:16,558 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,296.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:38:17,028 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:09:15 UTC)" executed successfully
2025-07-07 21:38:44,876 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 21:38:44,876 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 21:38:44,876 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 21:38:44,877 - __main__ - INFO - Bot is shutting down...
2025-07-07 21:38:45,156 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:38:45,156 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:38:45,157 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001BB3D5A76D0>
2025-07-07 21:38:45,157 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001BB60F86850>
2025-07-07 21:38:49,692 - __main__ - INFO - Starting bot...
2025-07-07 21:38:50,112 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:38:50,112 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:38:50,112 - __main__ - INFO - Bot is polling for updates...
2025-07-07 21:38:50,852 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 21:38:50,853 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 21:38:50,853 - telegram.ext.Application - INFO - Application started
2025-07-07 21:39:00,121 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:10:00 UTC)" (scheduled at 2025-07-07 16:09:00.111826+00:00)
2025-07-07 21:39:00,122 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:10:00 UTC)" executed successfully
2025-07-07 21:39:26,167 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:39:30,800 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:39:36,705 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-250709-106000-P: deribit does not have market symbol BTC-250709-106000-P
2025-07-07 21:40:00,116 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:11:00 UTC)" (scheduled at 2025-07-07 16:10:00.111826+00:00)
2025-07-07 21:40:00,117 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:40:00,677 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108398.70, Threshold: $500.00
2025-07-07 21:40:00,677 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 21:40:00,916 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 21:40:00,999 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 21:40:01,004 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:40:01,004 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,398.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:40:01,934 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:11:00 UTC)" executed successfully
2025-07-07 21:40:42,611 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:40:47,060 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:40:49,394 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-250708-109500-P: deribit does not have market symbol BTC-250708-109500-P
2025-07-07 21:41:00,132 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:12:00 UTC)" (scheduled at 2025-07-07 16:11:00.111826+00:00)
2025-07-07 21:41:00,133 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:41:00,668 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108367.80, Threshold: $500.00
2025-07-07 21:41:00,669 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:41:00,669 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,367.80, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:41:01,523 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:12:00 UTC)" executed successfully
2025-07-07 21:42:00,125 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:13:00 UTC)" (scheduled at 2025-07-07 16:12:00.111826+00:00)
2025-07-07 21:42:00,125 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:42:00,585 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108312.60, Threshold: $500.00
2025-07-07 21:42:00,586 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:42:00,586 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,312.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:42:01,443 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:13:00 UTC)" executed successfully
2025-07-07 21:43:00,136 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:14:00 UTC)" (scheduled at 2025-07-07 16:13:00.111826+00:00)
2025-07-07 21:43:00,136 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:43:00,769 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108365.00, Threshold: $500.00
2025-07-07 21:43:00,769 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:43:00,770 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,365.00, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:43:01,666 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:14:00 UTC)" executed successfully
2025-07-07 21:44:00,126 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:15:00 UTC)" (scheduled at 2025-07-07 16:14:00.111826+00:00)
2025-07-07 21:44:00,127 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:44:00,451 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108362.90, Threshold: $500.00
2025-07-07 21:44:00,451 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:44:00,452 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,362.90, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:44:01,223 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:15:00 UTC)" executed successfully
2025-07-07 21:45:00,117 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:16:00 UTC)" (scheduled at 2025-07-07 16:15:00.111826+00:00)
2025-07-07 21:45:00,118 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:45:00,501 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108277.70, Threshold: $500.00
2025-07-07 21:45:00,502 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:45:00,502 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,277.70, beta=0.9985, required_hedge_contracts=-0.9989
2025-07-07 21:45:01,239 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:16:00 UTC)" executed successfully
2025-07-07 21:46:00,117 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:17:00 UTC)" (scheduled at 2025-07-07 16:16:00.111826+00:00)
2025-07-07 21:46:00,118 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:46:00,622 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108299.60, Threshold: $500.00
2025-07-07 21:46:00,623 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:46:00,623 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,299.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:46:01,465 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:17:00 UTC)" executed successfully
2025-07-07 21:47:00,126 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:18:00 UTC)" (scheduled at 2025-07-07 16:17:00.111826+00:00)
2025-07-07 21:47:00,127 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:47:00,877 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108411.50, Threshold: $500.00
2025-07-07 21:47:00,877 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:47:00,877 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,411.50, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:47:01,918 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:18:00 UTC)" executed successfully
2025-07-07 21:48:00,118 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:19:00 UTC)" (scheduled at 2025-07-07 16:18:00.111826+00:00)
2025-07-07 21:48:00,119 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:48:00,880 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108411.00, Threshold: $500.00
2025-07-07 21:48:00,881 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:48:00,881 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,411.00, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:48:01,604 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:19:00 UTC)" executed successfully
2025-07-07 21:48:02,131 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 21:48:02,131 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 21:48:02,132 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 21:48:02,132 - __main__ - INFO - Bot is shutting down...
2025-07-07 21:48:02,373 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:48:02,373 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:48:02,373 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025524CEC450>
2025-07-07 21:48:02,374 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025523790A50>
2025-07-07 21:48:02,374 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000025524F324A0>, 38420.625), (<aiohttp.client_proto.ResponseHandler object at 0x0000025524F32900>, 38420.656)]']
connector: <aiohttp.connector.TCPConnector object at 0x00000255237A9750>
2025-07-07 21:48:05,465 - __main__ - INFO - Starting bot...
2025-07-07 21:48:05,888 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:48:05,888 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:48:05,888 - __main__ - INFO - Bot is polling for updates...
2025-07-07 21:48:06,613 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 21:48:06,613 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 21:48:06,613 - telegram.ext.Application - INFO - Application started
2025-07-07 21:48:15,893 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:19:15 UTC)" (scheduled at 2025-07-07 16:18:15.887855+00:00)
2025-07-07 21:48:15,894 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:19:15 UTC)" executed successfully
2025-07-07 21:48:39,973 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:48:45,494 - services.data_fetcher - INFO - Fetched 736 option instruments for BTC.
2025-07-07 21:48:48,544 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py", line 1195, in process_update
    await coroutine
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_conversationhandler.py", line 850, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_basehandler.py", line 153, in handle_update
    return await self.callback(update, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\bot\handlers.py", line 223, in select_strike
    expiry_date = datetime.strptime(raw_expiry, "%Y-%m-%d")
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Karthick\AppData\Local\Programs\Python\Python311\Lib\_strptime.py", line 567, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Karthick\AppData\Local\Programs\Python\Python311\Lib\_strptime.py", line 349, in _strptime
    raise ValueError("time data %r does not match format %r" %
ValueError: time data '250711' does not match format '%Y-%m-%d'
2025-07-07 21:49:15,902 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:20:15 UTC)" (scheduled at 2025-07-07 16:19:15.887855+00:00)
2025-07-07 21:49:15,903 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:49:16,438 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108472.60, Threshold: $500.00
2025-07-07 21:49:16,438 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 21:49:16,714 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 21:49:16,814 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 21:49:16,817 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:49:16,818 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,472.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 21:49:17,856 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:20:15 UTC)" executed successfully
2025-07-07 21:50:15,890 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:21:15 UTC)" (scheduled at 2025-07-07 16:20:15.887855+00:00)
2025-07-07 21:50:15,891 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:50:16,633 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108198.00, Threshold: $500.00
2025-07-07 21:50:16,635 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 21:50:16,635 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,198.00, beta=0.9985, required_hedge_contracts=-0.9991
2025-07-07 21:50:17,594 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:21:15 UTC)" executed successfully
2025-07-07 21:50:36,749 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 21:50:36,750 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 21:50:36,750 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 21:50:36,751 - __main__ - INFO - Bot is shutting down...
2025-07-07 21:50:37,211 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:50:37,211 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:50:37,211 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000017557F886D0>
2025-07-07 21:50:37,213 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001753977B310>
2025-07-07 21:50:40,066 - __main__ - INFO - Starting bot...
2025-07-07 21:50:40,530 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:50:40,531 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:50:40,531 - __main__ - INFO - Bot is polling for updates...
2025-07-07 21:50:41,330 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 21:50:41,330 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 21:50:41,330 - telegram.ext.Application - INFO - Application started
2025-07-07 21:50:50,546 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:21:50 UTC)" (scheduled at 2025-07-07 16:20:50.530311+00:00)
2025-07-07 21:50:50,547 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:21:50 UTC)" executed successfully
2025-07-07 21:51:02,633 - services.data_fetcher - INFO - Fetched 741 option instruments for BTC.
2025-07-07 21:51:07,567 - services.data_fetcher - INFO - Fetched 741 option instruments for BTC.
2025-07-07 21:51:10,278 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-25JUL08-107000-P: deribit does not have market symbol BTC-25JUL08-107000-P
2025-07-07 21:51:50,554 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:22:50 UTC)" (scheduled at 2025-07-07 16:21:50.530311+00:00)
2025-07-07 21:51:50,554 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:51:51,383 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108053.70, Threshold: $500.00
2025-07-07 21:51:51,383 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 21:51:51,629 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 21:51:51,714 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 21:51:51,719 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:51:51,719 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,053.70, beta=0.9984, required_hedge_contracts=-0.9990
2025-07-07 21:51:52,631 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:22:50 UTC)" executed successfully
2025-07-07 21:52:50,544 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:23:50 UTC)" (scheduled at 2025-07-07 16:22:50.530311+00:00)
2025-07-07 21:52:50,544 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:52:51,058 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108021.00, Threshold: $500.00
2025-07-07 21:52:51,058 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:52:51,058 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,021.00, beta=0.9984, required_hedge_contracts=-0.9991
2025-07-07 21:52:51,814 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:23:50 UTC)" executed successfully
2025-07-07 21:53:50,538 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:24:50 UTC)" (scheduled at 2025-07-07 16:23:50.530311+00:00)
2025-07-07 21:53:50,538 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:53:51,262 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108200.70, Threshold: $500.00
2025-07-07 21:53:51,262 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:53:51,262 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,200.70, beta=0.9984, required_hedge_contracts=-0.9988
2025-07-07 21:53:52,090 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:24:50 UTC)" executed successfully
2025-07-07 21:54:50,532 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:25:50 UTC)" (scheduled at 2025-07-07 16:24:50.530311+00:00)
2025-07-07 21:54:50,533 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:54:50,877 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108145.20, Threshold: $500.00
2025-07-07 21:54:50,877 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:54:50,877 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,145.20, beta=0.9984, required_hedge_contracts=-0.9990
2025-07-07 21:54:51,741 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:25:50 UTC)" executed successfully
2025-07-07 21:55:50,545 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:26:50 UTC)" (scheduled at 2025-07-07 16:25:50.530311+00:00)
2025-07-07 21:55:50,546 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:55:51,376 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108036.60, Threshold: $500.00
2025-07-07 21:55:51,376 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:55:51,376 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,036.60, beta=0.9984, required_hedge_contracts=-0.9989
2025-07-07 21:55:52,533 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:26:50 UTC)" executed successfully
2025-07-07 21:56:50,539 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:27:50 UTC)" (scheduled at 2025-07-07 16:26:50.530311+00:00)
2025-07-07 21:56:50,539 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:56:52,062 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108141.80, Threshold: $500.00
2025-07-07 21:56:52,063 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:56:52,063 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,141.80, beta=0.9984, required_hedge_contracts=-0.9990
2025-07-07 21:56:53,000 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:27:50 UTC)" executed successfully
2025-07-07 21:57:50,542 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:28:50 UTC)" (scheduled at 2025-07-07 16:27:50.530311+00:00)
2025-07-07 21:57:50,543 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:57:51,060 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108263.60, Threshold: $500.00
2025-07-07 21:57:51,062 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:57:51,062 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,263.60, beta=0.9984, required_hedge_contracts=-0.9988
2025-07-07 21:57:51,814 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:28:50 UTC)" executed successfully
2025-07-07 21:58:50,537 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:29:50 UTC)" (scheduled at 2025-07-07 16:28:50.530311+00:00)
2025-07-07 21:58:50,537 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 21:58:50,953 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108160.20, Threshold: $500.00
2025-07-07 21:58:50,954 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9984
2025-07-07 21:58:50,954 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,160.20, beta=0.9984, required_hedge_contracts=-0.9990
2025-07-07 21:58:51,818 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:29:50 UTC)" executed successfully
2025-07-07 21:59:43,758 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 21:59:43,758 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 21:59:43,759 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 21:59:43,759 - __main__ - INFO - Bot is shutting down...
2025-07-07 21:59:44,226 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:59:44,226 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 21:59:44,227 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000294B8CCDF90>
2025-07-07 21:59:44,227 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002949A6C0610>
2025-07-07 21:59:59,129 - __main__ - INFO - Starting bot...
2025-07-07 21:59:59,551 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 21:59:59,551 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 21:59:59,551 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:00:00,303 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:00:00,304 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:00:00,304 - telegram.ext.Application - INFO - Application started
2025-07-07 22:00:09,564 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:31:09 UTC)" (scheduled at 2025-07-07 16:30:09.550461+00:00)
2025-07-07 22:00:09,565 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:31:09 UTC)" executed successfully
2025-07-07 22:00:58,665 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:01:04,474 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:01:09,550 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:32:09 UTC)" (scheduled at 2025-07-07 16:31:09.550461+00:00)
2025-07-07 22:01:09,551 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:01:09,748 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-25JUL09-106000-P: deribit does not have market symbol BTC-25JUL09-106000-P
2025-07-07 22:01:10,006 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108299.90, Threshold: $500.00
2025-07-07 22:01:10,006 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:01:10,274 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:01:10,392 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:01:10,399 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:01:10,399 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,299.90, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:01:10,787 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:32:09 UTC)" executed successfully
2025-07-07 22:02:09,565 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:33:09 UTC)" (scheduled at 2025-07-07 16:32:09.550461+00:00)
2025-07-07 22:02:09,566 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:02:10,282 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108221.80, Threshold: $500.00
2025-07-07 22:02:10,282 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:02:10,282 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,221.80, beta=0.9985, required_hedge_contracts=-0.9989
2025-07-07 22:02:11,220 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:33:09 UTC)" executed successfully
2025-07-07 22:03:09,572 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:34:09 UTC)" (scheduled at 2025-07-07 16:33:09.550461+00:00)
2025-07-07 22:03:09,572 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:03:10,032 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108274.70, Threshold: $500.00
2025-07-07 22:03:10,032 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:03:10,033 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,274.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:03:10,903 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:34:09 UTC)" executed successfully
2025-07-07 22:04:07,866 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:04:07,866 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:04:07,866 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:04:07,867 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:04:08,081 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:04:08,082 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:04:08,082 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025FFF093710>
2025-07-07 22:04:08,082 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000025F9A76A390>
2025-07-07 22:04:11,082 - __main__ - INFO - Starting bot...
2025-07-07 22:04:11,518 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:04:11,518 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:04:11,518 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:04:12,265 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:04:12,265 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:04:12,265 - telegram.ext.Application - INFO - Application started
2025-07-07 22:04:21,531 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:35:21 UTC)" (scheduled at 2025-07-07 16:34:21.517771+00:00)
2025-07-07 22:04:21,532 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:35:21 UTC)" executed successfully
2025-07-07 22:04:46,404 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:04:51,843 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:04:55,141 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-25JUL09-107000-P: deribit does not have market symbol BTC-25JUL09-107000-P
2025-07-07 22:05:21,528 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:36:21 UTC)" (scheduled at 2025-07-07 16:35:21.517771+00:00)
2025-07-07 22:05:21,528 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:05:22,264 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108299.60, Threshold: $500.00
2025-07-07 22:05:22,264 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:05:22,522 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:05:22,781 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:05:22,787 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:05:22,788 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,299.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:05:23,663 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:36:21 UTC)" executed successfully
2025-07-07 22:06:21,534 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:37:21 UTC)" (scheduled at 2025-07-07 16:36:21.517771+00:00)
2025-07-07 22:06:21,534 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:06:22,167 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108199.60, Threshold: $500.00
2025-07-07 22:06:22,167 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:06:22,167 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,199.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:06:22,996 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:37:21 UTC)" executed successfully
2025-07-07 22:06:34,217 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:06:34,217 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:06:34,217 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:06:34,218 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:06:34,449 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:06:34,449 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:06:34,450 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000018D752F2950>
2025-07-07 22:06:34,450 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000018D76AF3810>
2025-07-07 22:06:34,450 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000018D769EB850>, 39521.937), (<aiohttp.client_proto.ResponseHandler object at 0x0000018D76AB2EB0>, 39521.937)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000018D75301BD0>
2025-07-07 22:06:40,072 - __main__ - INFO - Starting bot...
2025-07-07 22:06:40,498 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:06:40,498 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:06:40,498 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:06:41,223 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:06:41,223 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:06:41,223 - telegram.ext.Application - INFO - Application started
2025-07-07 22:06:50,510 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:37:50 UTC)" (scheduled at 2025-07-07 16:36:50.498412+00:00)
2025-07-07 22:06:50,510 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:06:52,925 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108317.70, Threshold: $500.00
2025-07-07 22:06:52,926 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:06:53,175 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:06:53,276 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:06:53,280 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:06:53,281 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,317.70, beta=0.9985, required_hedge_contracts=-0.9989
2025-07-07 22:06:54,155 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:37:50 UTC)" executed successfully
2025-07-07 22:07:02,662 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:07:05,455 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:07:10,140 - core.risk_engine - ERROR - Error calculating greeks for BTC-27MAR26-100000-C: 'strike_price'
2025-07-07 22:07:50,499 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:38:50 UTC)" (scheduled at 2025-07-07 16:37:50.498412+00:00)
2025-07-07 22:07:50,500 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:07:51,092 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108352.50, Threshold: $500.00
2025-07-07 22:07:51,092 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:07:51,093 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,352.50, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:07:51,980 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:38:50 UTC)" executed successfully
2025-07-07 22:08:35,689 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:08:35,690 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:08:35,690 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021F7FD60B90>
2025-07-07 22:08:35,691 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000021F054FE210>
2025-07-07 22:08:35,696 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Application:7199431920:update_fetcher' coro=<Application._update_fetcher() running at D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py:1110> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-07-07 22:09:49,918 - __main__ - INFO - Starting bot...
2025-07-07 22:09:50,450 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:09:50,450 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:09:50,450 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:09:51,301 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:09:51,301 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:09:51,301 - telegram.ext.Application - INFO - Application started
2025-07-07 22:10:00,455 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:41:00 UTC)" (scheduled at 2025-07-07 16:40:00.449954+00:00)
2025-07-07 22:10:00,456 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:41:00 UTC)" executed successfully
2025-07-07 22:11:00,459 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:42:00 UTC)" (scheduled at 2025-07-07 16:41:00.449954+00:00)
2025-07-07 22:11:00,460 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:42:00 UTC)" executed successfully
2025-07-07 22:11:22,704 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:11:27,988 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:11:30,487 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-09JUL25-106000-P: deribit does not have market symbol BTC-09JUL25-106000-P
2025-07-07 22:12:00,467 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:43:00 UTC)" (scheduled at 2025-07-07 16:42:00.449954+00:00)
2025-07-07 22:12:00,467 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:12:01,045 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108182.00, Threshold: $500.00
2025-07-07 22:12:01,045 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:12:01,288 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:12:01,388 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:12:01,392 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:12:01,393 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,182.00, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:12:02,170 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:43:00 UTC)" executed successfully
2025-07-07 22:13:00,466 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:44:00 UTC)" (scheduled at 2025-07-07 16:43:00.449954+00:00)
2025-07-07 22:13:00,467 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:13:01,912 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108219.70, Threshold: $500.00
2025-07-07 22:13:01,913 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:13:01,913 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,219.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:13:02,642 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:44:00 UTC)" executed successfully
2025-07-07 22:13:35,865 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:14:00,465 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:45:00 UTC)" (scheduled at 2025-07-07 16:44:00.449954+00:00)
2025-07-07 22:14:00,465 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:14:01,068 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108184.00, Threshold: $500.00
2025-07-07 22:14:01,068 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:14:01,068 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,184.00, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:14:01,710 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:14:01,942 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:45:00 UTC)" executed successfully
2025-07-07 22:14:01,944 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:14:01,944 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:14:01,945 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:14:02,172 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:14:02,172 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:14:02,172 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002EEE83624D0>
2025-07-07 22:14:02,173 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002EEE9AAEFD0>
2025-07-07 22:14:02,173 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002EEE9B251D0>, 39980.843), (<aiohttp.client_proto.ResponseHandler object at 0x000002EEE9B27D20>, 39980.843)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002EEE9E19610>
2025-07-07 22:14:04,992 - __main__ - INFO - Starting bot...
2025-07-07 22:14:05,431 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:14:05,431 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:14:05,431 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:14:06,184 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:14:06,184 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:14:06,185 - telegram.ext.Application - INFO - Application started
2025-07-07 22:14:15,436 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:45:15 UTC)" (scheduled at 2025-07-07 16:44:15.430965+00:00)
2025-07-07 22:14:15,437 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:45:15 UTC)" executed successfully
2025-07-07 22:14:32,092 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:14:37,728 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:14:40,108 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-08JUL25-107000-P: deribit does not have market symbol BTC-08JUL25-107000-P
2025-07-07 22:15:15,441 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:46:15 UTC)" (scheduled at 2025-07-07 16:45:15.430965+00:00)
2025-07-07 22:15:15,442 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:15:16,232 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108307.20, Threshold: $500.00
2025-07-07 22:15:16,232 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:15:16,502 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:15:16,607 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:15:16,613 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:15:16,613 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,307.20, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:15:17,605 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:46:15 UTC)" executed successfully
2025-07-07 22:16:15,443 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:47:15 UTC)" (scheduled at 2025-07-07 16:46:15.430965+00:00)
2025-07-07 22:16:15,443 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:16:15,916 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108222.60, Threshold: $500.00
2025-07-07 22:16:15,916 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:16:15,916 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,222.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:16:16,757 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:47:15 UTC)" executed successfully
2025-07-07 22:17:09,931 - __main__ - INFO - Starting bot...
2025-07-07 22:17:10,339 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:17:10,339 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:17:10,339 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:17:11,156 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:17:11,157 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:17:11,157 - telegram.ext.Application - INFO - Application started
2025-07-07 22:17:20,349 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:48:20 UTC)" (scheduled at 2025-07-07 16:47:20.338587+00:00)
2025-07-07 22:17:20,350 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:48:20 UTC)" executed successfully
2025-07-07 22:17:31,992 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:17:36,683 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:17:39,669 - core.risk_engine - ERROR - Error calculating greeks for BTC-9JUL25-107000-P: unsupported operand type(s) for /: 'str' and 'int'
2025-07-07 22:18:20,350 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:49:20 UTC)" (scheduled at 2025-07-07 16:48:20.338587+00:00)
2025-07-07 22:18:20,350 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:18:21,971 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108074.80, Threshold: $500.00
2025-07-07 22:18:21,971 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:18:22,188 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:18:22,302 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:18:22,307 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:18:22,307 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,074.80, beta=0.9985, required_hedge_contracts=-0.9989
2025-07-07 22:18:23,111 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:49:20 UTC)" executed successfully
2025-07-07 22:19:03,941 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:19:03,941 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:19:03,942 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:19:03,942 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:19:04,160 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:19:04,161 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:19:04,161 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002CCBCDEC1D0>
2025-07-07 22:19:04,161 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002CCBCDBF850>
2025-07-07 22:19:07,063 - __main__ - INFO - Starting bot...
2025-07-07 22:19:07,470 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:19:07,470 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:19:07,470 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:19:08,214 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:19:08,216 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:19:08,216 - telegram.ext.Application - INFO - Application started
2025-07-07 22:19:17,472 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:50:17 UTC)" (scheduled at 2025-07-07 16:49:17.470297+00:00)
2025-07-07 22:19:17,472 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:19:18,750 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108040.90, Threshold: $500.00
2025-07-07 22:19:18,750 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:19:18,899 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:19:19,089 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:19:19,093 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:19:19,094 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,040.90, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:19:19,929 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:50:17 UTC)" executed successfully
2025-07-07 22:19:24,861 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:19:27,545 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:19:30,592 - core.risk_engine - ERROR - Error calculating greeks for BTC-8JUL25-107500-P: 'option_type'
2025-07-07 22:20:17,475 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:51:17 UTC)" (scheduled at 2025-07-07 16:50:17.470297+00:00)
2025-07-07 22:20:17,475 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:20:18,108 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107950.10, Threshold: $500.00
2025-07-07 22:20:18,108 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:20:18,108 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,950.10, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:20:18,965 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:51:17 UTC)" executed successfully
2025-07-07 22:21:17,479 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:52:17 UTC)" (scheduled at 2025-07-07 16:51:17.470297+00:00)
2025-07-07 22:21:17,480 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:21:18,806 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107981.70, Threshold: $500.00
2025-07-07 22:21:18,807 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:21:18,807 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,981.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:21:19,565 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:52:17 UTC)" executed successfully
2025-07-07 22:21:35,003 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:21:35,004 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:21:35,004 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:21:35,004 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:21:35,209 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:21:35,210 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:21:35,210 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000138E6E19490>
2025-07-07 22:21:35,211 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000138E6E31490>
2025-07-07 22:21:37,643 - __main__ - INFO - Starting bot...
2025-07-07 22:21:38,068 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:21:38,069 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:21:38,069 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:21:38,795 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:21:38,795 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:21:38,795 - telegram.ext.Application - INFO - Application started
2025-07-07 22:21:48,078 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:52:48 UTC)" (scheduled at 2025-07-07 16:51:48.067780+00:00)
2025-07-07 22:21:48,078 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:52:48 UTC)" executed successfully
2025-07-07 22:21:57,765 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:22:01,879 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:22:04,874 - core.risk_engine - ERROR - Error calculating greeks for BTC-9JUL25-106000-P: 'option_type'
2025-07-07 22:22:42,750 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:22:42,751 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:22:42,751 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:22:42,751 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:22:42,977 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:22:42,978 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:22:42,978 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AC7FD69850>
2025-07-07 22:22:42,979 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AC7E93DB10>
2025-07-07 22:22:45,518 - __main__ - INFO - Starting bot...
2025-07-07 22:22:45,926 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:22:45,927 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:22:45,927 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:22:46,695 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:22:46,695 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:22:46,696 - telegram.ext.Application - INFO - Application started
2025-07-07 22:22:55,926 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:53:55 UTC)" (scheduled at 2025-07-07 16:52:55.925747+00:00)
2025-07-07 22:22:55,926 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:22:57,152 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108064.20, Threshold: $500.00
2025-07-07 22:22:57,153 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:22:57,361 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:22:57,470 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:22:57,475 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:22:57,475 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,064.20, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:22:58,363 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:53:55 UTC)" executed successfully
2025-07-07 22:23:03,596 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:23:09,249 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:23:12,246 - core.risk_engine - ERROR - Error calculating greeks for BTC-9JUL25-106000-P: float() argument must be a string or a real number, not 'NoneType'
2025-07-07 22:23:55,939 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:54:55 UTC)" (scheduled at 2025-07-07 16:53:55.925747+00:00)
2025-07-07 22:23:55,940 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:23:56,316 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108053.70, Threshold: $500.00
2025-07-07 22:23:56,316 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:23:56,317 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,053.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:23:57,217 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:54:55 UTC)" executed successfully
2025-07-07 22:24:55,932 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:55:55 UTC)" (scheduled at 2025-07-07 16:54:55.925747+00:00)
2025-07-07 22:24:55,932 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:24:56,356 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107982.20, Threshold: $500.00
2025-07-07 22:24:56,356 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:24:56,356 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,982.20, beta=0.9985, required_hedge_contracts=-0.9989
2025-07-07 22:24:57,236 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:55:55 UTC)" executed successfully
2025-07-07 22:25:55,938 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:56:55 UTC)" (scheduled at 2025-07-07 16:55:55.925747+00:00)
2025-07-07 22:25:55,939 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:25:57,116 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107968.60, Threshold: $500.00
2025-07-07 22:25:57,116 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:25:57,116 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,968.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:25:57,885 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:56:55 UTC)" executed successfully
2025-07-07 22:26:35,655 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:26:35,656 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:26:35,656 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:26:35,657 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:26:35,869 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:26:35,869 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:26:35,869 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001DA642F0A50>
2025-07-07 22:26:35,870 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001DA4476EED0>
2025-07-07 22:26:38,809 - __main__ - INFO - Starting bot...
2025-07-07 22:26:39,222 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:26:39,222 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:26:39,222 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:26:39,925 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:26:39,925 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:26:39,926 - telegram.ext.Application - INFO - Application started
2025-07-07 22:26:49,230 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:57:49 UTC)" (scheduled at 2025-07-07 16:56:49.221517+00:00)
2025-07-07 22:26:49,231 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:26:50,742 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107986.80, Threshold: $500.00
2025-07-07 22:26:50,742 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:26:50,993 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:26:51,086 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:26:51,090 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:26:51,090 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,986.80, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:26:51,528 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:57:49 UTC)" executed successfully
2025-07-07 22:26:57,554 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:27:00,698 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:27:03,688 - core.risk_engine - ERROR - Error calculating greeks for N/A: time data '250708' does not match format '%d%b%y'
2025-07-07 22:27:49,237 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:58:49 UTC)" (scheduled at 2025-07-07 16:57:49.221517+00:00)
2025-07-07 22:27:49,238 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:27:50,071 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107953.20, Threshold: $500.00
2025-07-07 22:27:50,071 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:27:50,071 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,953.20, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:27:50,919 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:58:49 UTC)" executed successfully
2025-07-07 22:28:49,232 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:59:49 UTC)" (scheduled at 2025-07-07 16:58:49.221517+00:00)
2025-07-07 22:28:49,233 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:28:50,016 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107986.80, Threshold: $500.00
2025-07-07 22:28:50,016 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:28:50,016 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,986.80, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:28:51,075 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 16:59:49 UTC)" executed successfully
2025-07-07 22:29:49,225 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:00:49 UTC)" (scheduled at 2025-07-07 16:59:49.221517+00:00)
2025-07-07 22:29:49,225 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:29:49,603 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107960.70, Threshold: $500.00
2025-07-07 22:29:49,603 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:29:49,604 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,960.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:29:50,494 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:00:49 UTC)" executed successfully
2025-07-07 22:30:49,238 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:01:49 UTC)" (scheduled at 2025-07-07 17:00:49.221517+00:00)
2025-07-07 22:30:49,238 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:30:49,907 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107934.10, Threshold: $500.00
2025-07-07 22:30:49,908 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:30:49,908 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,934.10, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:30:50,739 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:01:49 UTC)" executed successfully
2025-07-07 22:31:49,226 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:02:49 UTC)" (scheduled at 2025-07-07 17:01:49.221517+00:00)
2025-07-07 22:31:49,227 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:31:49,733 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107901.00, Threshold: $500.00
2025-07-07 22:31:49,733 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:31:49,733 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,901.00, beta=0.9985, required_hedge_contracts=-0.9989
2025-07-07 22:31:50,546 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:02:49 UTC)" executed successfully
2025-07-07 22:32:49,240 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:03:49 UTC)" (scheduled at 2025-07-07 17:02:49.221517+00:00)
2025-07-07 22:32:49,240 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:32:49,753 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107894.60, Threshold: $500.00
2025-07-07 22:32:49,753 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:32:49,753 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,894.60, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:32:50,585 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:03:49 UTC)" executed successfully
2025-07-07 22:33:49,231 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:04:49 UTC)" (scheduled at 2025-07-07 17:03:49.221517+00:00)
2025-07-07 22:33:49,231 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:33:49,760 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107887.20, Threshold: $500.00
2025-07-07 22:33:49,760 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:33:49,760 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,887.20, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:33:50,633 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:04:49 UTC)" executed successfully
2025-07-07 22:34:14,104 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:34:14,105 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:34:14,105 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:34:14,106 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:34:14,323 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:34:14,323 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:34:14,323 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F67FDB3B10>
2025-07-07 22:34:14,323 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001F612D2EA50>
2025-07-07 22:34:16,948 - __main__ - INFO - Starting bot...
2025-07-07 22:34:17,382 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:34:17,382 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:34:17,383 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:34:18,105 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:34:18,105 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:34:18,105 - telegram.ext.Application - INFO - Application started
2025-07-07 22:34:27,392 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:05:27 UTC)" (scheduled at 2025-07-07 17:04:27.382790+00:00)
2025-07-07 22:34:27,392 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:05:27 UTC)" executed successfully
2025-07-07 22:34:40,441 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:34:45,075 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:34:48,050 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-8JUL25-107000-P: 'result'
2025-07-07 22:35:27,384 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:06:27 UTC)" (scheduled at 2025-07-07 17:05:27.382790+00:00)
2025-07-07 22:35:27,384 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:35:27,904 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107812.70, Threshold: $500.00
2025-07-07 22:35:27,905 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:35:28,142 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:35:28,227 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:35:28,232 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:35:28,232 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,812.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:35:28,997 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:06:27 UTC)" executed successfully
2025-07-07 22:35:35,265 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:35:37,645 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:35:41,096 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-8JUL25-107000-P: 'result'
2025-07-07 22:35:53,569 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:35:53,570 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:35:53,570 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D1B1771E50>
2025-07-07 22:35:53,570 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D1B2F37D90>, 41280.875)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D1B2F8AA10>
2025-07-07 22:35:53,570 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D1B178F250>
2025-07-07 22:35:53,571 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001D1B2E6B070>, 41280.031)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001D1B177B190>
2025-07-07 22:35:53,574 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Application:7199431920:update_fetcher' coro=<Application._update_fetcher() running at D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py:1110> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-07-07 22:35:57,237 - __main__ - INFO - Starting bot...
2025-07-07 22:35:57,656 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:35:57,657 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:35:57,657 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:35:58,390 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:35:58,391 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:35:58,391 - telegram.ext.Application - INFO - Application started
2025-07-07 22:36:07,660 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:07:07 UTC)" (scheduled at 2025-07-07 17:06:07.656251+00:00)
2025-07-07 22:36:07,661 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:07:07 UTC)" executed successfully
2025-07-07 22:36:29,110 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:36:34,160 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:36:36,853 - services.data_fetcher - ERROR - Error fetching ticker for option BTC-8JUL25-107000-P: 'result'
2025-07-07 22:37:07,660 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:08:07 UTC)" (scheduled at 2025-07-07 17:07:07.656251+00:00)
2025-07-07 22:37:07,661 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:37:08,303 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107903.30, Threshold: $500.00
2025-07-07 22:37:08,303 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:37:08,535 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:37:08,645 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:37:08,649 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:37:08,649 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,903.30, beta=0.9986, required_hedge_contracts=-0.9990
2025-07-07 22:37:09,509 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:08:07 UTC)" executed successfully
2025-07-07 22:38:07,658 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:09:07 UTC)" (scheduled at 2025-07-07 17:08:07.656251+00:00)
2025-07-07 22:38:07,659 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:38:08,501 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107964.90, Threshold: $500.00
2025-07-07 22:38:08,501 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:38:08,501 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,964.90, beta=0.9986, required_hedge_contracts=-0.9991
2025-07-07 22:38:09,225 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:09:07 UTC)" executed successfully
2025-07-07 22:39:07,665 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:10:07 UTC)" (scheduled at 2025-07-07 17:09:07.656251+00:00)
2025-07-07 22:39:07,666 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:39:08,212 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107959.70, Threshold: $500.00
2025-07-07 22:39:08,212 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:39:08,213 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,959.70, beta=0.9986, required_hedge_contracts=-0.9990
2025-07-07 22:39:09,038 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:10:07 UTC)" executed successfully
2025-07-07 22:40:07,658 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:11:07 UTC)" (scheduled at 2025-07-07 17:10:07.656251+00:00)
2025-07-07 22:40:07,659 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:40:08,229 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107854.10, Threshold: $500.00
2025-07-07 22:40:08,231 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:40:08,231 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,854.10, beta=0.9986, required_hedge_contracts=-0.9991
2025-07-07 22:40:09,059 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:11:07 UTC)" executed successfully
2025-07-07 22:41:07,676 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:12:07 UTC)" (scheduled at 2025-07-07 17:11:07.656251+00:00)
2025-07-07 22:41:07,676 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:41:09,291 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107947.20, Threshold: $500.00
2025-07-07 22:41:09,291 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:41:09,291 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,947.20, beta=0.9986, required_hedge_contracts=-0.9991
2025-07-07 22:41:10,103 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:12:07 UTC)" executed successfully
2025-07-07 22:42:07,657 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:13:07 UTC)" (scheduled at 2025-07-07 17:12:07.656251+00:00)
2025-07-07 22:42:07,658 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:42:08,400 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $107923.30, Threshold: $500.00
2025-07-07 22:42:08,400 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:42:08,401 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$107,923.30, beta=0.9986, required_hedge_contracts=-0.9990
2025-07-07 22:42:09,332 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:13:07 UTC)" executed successfully
2025-07-07 22:43:07,678 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:14:07 UTC)" (scheduled at 2025-07-07 17:13:07.656251+00:00)
2025-07-07 22:43:07,679 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:43:08,304 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108029.10, Threshold: $500.00
2025-07-07 22:43:08,304 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:43:08,305 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,029.10, beta=0.9986, required_hedge_contracts=-0.9991
2025-07-07 22:43:10,837 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:14:07 UTC)" executed successfully
2025-07-07 22:44:07,674 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:15:07 UTC)" (scheduled at 2025-07-07 17:14:07.656251+00:00)
2025-07-07 22:44:07,675 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:44:09,074 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108048.10, Threshold: $500.00
2025-07-07 22:44:09,074 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:44:09,076 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,048.10, beta=0.9986, required_hedge_contracts=-0.9991
2025-07-07 22:44:09,902 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:15:07 UTC)" executed successfully
2025-07-07 22:45:07,665 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:16:07 UTC)" (scheduled at 2025-07-07 17:15:07.656251+00:00)
2025-07-07 22:45:07,665 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:45:08,155 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108030.50, Threshold: $500.00
2025-07-07 22:45:08,155 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9986
2025-07-07 22:45:08,156 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,030.50, beta=0.9986, required_hedge_contracts=-0.9991
2025-07-07 22:45:09,012 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:16:07 UTC)" executed successfully
2025-07-07 22:46:05,184 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:46:05,185 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:46:05,185 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:46:05,185 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:46:05,407 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:46:05,408 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:46:05,408 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AF8D1C1F90>
2025-07-07 22:46:05,408 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001AF8D1A6110>
2025-07-07 22:46:08,636 - __main__ - INFO - Starting bot...
2025-07-07 22:46:09,065 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:46:09,065 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:46:09,065 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:46:09,864 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:46:09,864 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:46:09,865 - telegram.ext.Application - INFO - Application started
2025-07-07 22:46:19,068 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:17:19 UTC)" (scheduled at 2025-07-07 17:16:19.064372+00:00)
2025-07-07 22:46:19,068 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:46:20,665 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108026.30, Threshold: $500.00
2025-07-07 22:46:20,665 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:46:20,899 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:46:20,998 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:46:21,002 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:46:21,002 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,026.30, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:46:21,377 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:17:19 UTC)" executed successfully
2025-07-07 22:46:33,321 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:46:38,492 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:46:41,760 - core.risk_engine - ERROR - Error calculating greeks for N/A: 'greeks'
2025-07-07 22:47:19,072 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:18:19 UTC)" (scheduled at 2025-07-07 17:17:19.064372+00:00)
2025-07-07 22:47:19,073 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:47:19,522 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108031.10, Threshold: $500.00
2025-07-07 22:47:19,522 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:47:19,522 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,031.10, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:47:20,291 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:18:19 UTC)" executed successfully
2025-07-07 22:48:19,068 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:19:19 UTC)" (scheduled at 2025-07-07 17:18:19.064372+00:00)
2025-07-07 22:48:19,068 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:48:19,746 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108026.30, Threshold: $500.00
2025-07-07 22:48:19,747 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:48:19,747 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,026.30, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:48:20,587 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:19:19 UTC)" executed successfully
2025-07-07 22:48:26,480 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:48:26,480 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:48:26,480 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002DEFE7E4C90>
2025-07-07 22:48:26,481 - asyncio - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000002DEFFF83EE0>, 42039.421), (<aiohttp.client_proto.ResponseHandler object at 0x000002DEFFF83770>, 42039.515)]']
connector: <aiohttp.connector.TCPConnector object at 0x000002DEFFFC3B10>
2025-07-07 22:48:26,481 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002DEFFDA7650>
2025-07-07 22:48:26,484 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Application:7199431920:update_fetcher' coro=<Application._update_fetcher() running at D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py:1110> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-07-07 22:48:29,010 - __main__ - INFO - Starting bot...
2025-07-07 22:48:29,425 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:48:29,425 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:48:29,426 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:48:30,139 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:48:30,141 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:48:30,141 - telegram.ext.Application - INFO - Application started
2025-07-07 22:48:39,442 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:19:39 UTC)" (scheduled at 2025-07-07 17:18:39.425021+00:00)
2025-07-07 22:48:39,443 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:48:41,320 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108032.70, Threshold: $500.00
2025-07-07 22:48:41,320 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:48:41,635 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:48:41,731 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:48:41,735 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:48:41,735 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,032.70, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:48:42,110 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:19:39 UTC)" executed successfully
2025-07-07 22:48:45,078 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:48:47,593 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:48:50,110 - core.risk_engine - ERROR - Error calculating greeks for N/A: 'greeks'
2025-07-07 22:49:39,428 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:20:39 UTC)" (scheduled at 2025-07-07 17:19:39.425021+00:00)
2025-07-07 22:49:39,429 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:49:40,155 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108006.00, Threshold: $500.00
2025-07-07 22:49:40,155 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:49:40,155 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,006.00, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:49:40,889 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:20:39 UTC)" executed successfully
2025-07-07 22:50:39,437 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:21:39 UTC)" (scheduled at 2025-07-07 17:20:39.425021+00:00)
2025-07-07 22:50:39,438 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:50:40,002 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108069.00, Threshold: $500.00
2025-07-07 22:50:40,003 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:50:40,003 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,069.00, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:50:40,918 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:21:39 UTC)" executed successfully
2025-07-07 22:51:10,553 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-07 22:51:10,553 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-07-07 22:51:10,554 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-07 22:51:10,554 - __main__ - INFO - Bot is shutting down...
2025-07-07 22:51:10,772 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:51:10,773 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:51:10,773 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001A7610FF850>
2025-07-07 22:51:10,773 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001A75F87F590>
2025-07-07 22:51:27,016 - __main__ - INFO - Starting bot...
2025-07-07 22:51:27,430 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:51:27,430 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:51:27,430 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:51:28,211 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:51:28,211 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:51:28,211 - telegram.ext.Application - INFO - Application started
2025-07-07 22:51:37,439 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:22:37 UTC)" (scheduled at 2025-07-07 17:21:37.429238+00:00)
2025-07-07 22:51:37,439 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:22:37 UTC)" executed successfully
2025-07-07 22:51:51,126 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:51:55,526 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:51:58,082 - core.risk_engine - ERROR - Error calculating greeks for N/A: 'greeks'
2025-07-07 22:52:37,448 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:23:37 UTC)" (scheduled at 2025-07-07 17:22:37.429238+00:00)
2025-07-07 22:52:37,449 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:52:38,810 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108093.90, Threshold: $500.00
2025-07-07 22:52:38,811 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:52:39,055 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:52:39,156 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:52:39,160 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:52:39,161 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,093.90, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:52:39,994 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:23:37 UTC)" executed successfully
2025-07-07 22:53:37,440 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:24:37 UTC)" (scheduled at 2025-07-07 17:23:37.429238+00:00)
2025-07-07 22:53:37,440 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:53:37,948 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108088.40, Threshold: $500.00
2025-07-07 22:53:37,948 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:53:37,948 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,088.40, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:53:38,686 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:24:37 UTC)" executed successfully
2025-07-07 22:53:53,514 - ccxt.base.exchange - WARNING - bybit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:53:53,515 - ccxt.base.exchange - WARNING - deribit requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-07-07 22:53:53,515 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D42FA56FD0>
2025-07-07 22:53:53,516 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D42E490110>
2025-07-07 22:53:53,520 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Application:7199431920:update_fetcher' coro=<Application._update_fetcher() running at D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py:1110> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-07-07 22:53:58,262 - __main__ - INFO - Starting bot...
2025-07-07 22:53:58,668 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-07-07 22:53:58,668 - __main__ - INFO - Risk checking job scheduled to run every 60 seconds.
2025-07-07 22:53:58,668 - __main__ - INFO - Bot is polling for updates...
2025-07-07 22:53:59,418 - apscheduler.scheduler - INFO - Added job "risk_check_job" to job store "default"
2025-07-07 22:53:59,418 - apscheduler.scheduler - INFO - Scheduler started
2025-07-07 22:53:59,419 - telegram.ext.Application - INFO - Application started
2025-07-07 22:54:08,678 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:25:08 UTC)" (scheduled at 2025-07-07 17:24:08.667404+00:00)
2025-07-07 22:54:08,678 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:54:10,146 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108090.20, Threshold: $500.00
2025-07-07 22:54:10,147 - core.risk_engine - INFO - Cache miss or expired for bybit:BTC/USDT:BTC/USDT:USDT. Fetching fresh historical data...
2025-07-07 22:54:10,379 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT from bybit
2025-07-07 22:54:10,474 - services.data_fetcher - INFO - Successfully fetched 90 historical data points for BTC/USDT:USDT from bybit
2025-07-07 22:54:10,478 - core.risk_engine - INFO - Calculated new beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:54:10,478 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,090.20, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:54:11,287 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:25:08 UTC)" executed successfully
2025-07-07 22:54:16,152 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:54:18,785 - services.data_fetcher - INFO - Fetched 738 option instruments for BTC.
2025-07-07 22:54:21,590 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_application.py", line 1195, in process_update
    await coroutine
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_conversationhandler.py", line 850, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\venv\Lib\site-packages\telegram\ext\_basehandler.py", line 153, in handle_update
    return await self.callback(update, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\spot_hedging_bot\bot\handlers.py", line 252, in select_strike
    position_size = user_positions[query.effective_chat.id]['size']
                                   ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'CallbackQuery' object has no attribute 'effective_chat'
2025-07-07 22:55:08,677 - apscheduler.executors.default - INFO - Running job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:26:08 UTC)" (scheduled at 2025-07-07 17:25:08.667404+00:00)
2025-07-07 22:55:08,678 - bot.handlers - INFO - Running REAL-TIME risk check job for 1 users.
2025-07-07 22:55:09,583 - bot.handlers - INFO - RISK THRESHOLD BREACHED for user 5063784984. Delta: $108001.80, Threshold: $500.00
2025-07-07 22:55:09,583 - core.risk_engine - INFO - Using cached beta for bybit:BTC/USDT:BTC/USDT:USDT: 0.9985
2025-07-07 22:55:09,583 - core.risk_engine - INFO - Hedge calculation: spot_delta_usd=$108,001.80, beta=0.9985, required_hedge_contracts=-0.9990
2025-07-07 22:55:10,414 - apscheduler.executors.default - INFO - Job "risk_check_job (trigger: interval[0:01:00], next run at: 2025-07-07 17:26:08 UTC)" executed successfully
